/**
 * ============================================================
 * JavaScriptì˜ this - 2
 * ============================================================
 *
 * ì´ë²ˆì—ëŠ” thisê°€ ì–´ë–»ê²Œ ë°”ì¸ë”©ë˜ëŠ”ì§€ì— ëŒ€í•´ ë‹¤ìŒ ë‘ ê°€ì§€ í˜¸ì¶œ ë°©ì‹ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‚´í´ë³¸ë‹¤.
 *
 * 3. ìƒì„±ì í•¨ìˆ˜ í˜¸ì¶œ
 * 4. ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
 *
 * - thisëŠ” "í•¨ìˆ˜ê°€ ì •ì˜ëœ ìœ„ì¹˜"ê°€ ì•„ë‹ˆë¼ "í•¨ìˆ˜ê°€ ì–´ë–»ê²Œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€"ì— ë”°ë¼ ê²°ì •ëœë‹¤.
 */

/* ============================================================
 * 3. ìƒì„±ì í•¨ìˆ˜ í˜¸ì¶œ
 * ============================================================
 *
 * ìƒì„±ì í•¨ìˆ˜ë€?
 * - new í‚¤ì›Œë“œì™€ í•¨ê»˜ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
 * - ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
 *
 * ìƒì„±ì í•¨ìˆ˜ í˜¸ì¶œ ì‹œ this:
 * - thisëŠ” ìƒˆë¡œ ìƒì„±ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ ê°ì²´ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
 */

function Cafe(menu) {
  // new Cafe()ë¡œ í˜¸ì¶œë˜ë©´,
  // thisëŠ” ìƒˆë¡œ ë§Œë“¤ì–´ì§ˆ ë¹ˆ ê°ì²´ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
  console.log(this);

  // thisì— í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•˜ë©´
  // ìƒì„±ëœ ê°ì²´ì— ê°’ì´ ì €ì¥ëœë‹¤.
  this.menu = menu;
}

// ìƒì„±ì í•¨ìˆ˜ í˜¸ì¶œ
let myCafe = new Cafe("latte"); // Cafe {}
console.log(myCafe); // Cafe { menu: "latte" }

/**
 * new í‚¤ì›Œë“œ ì—†ì´ í˜¸ì¶œí•œ ê²½ìš°
 *
 * - ìƒì„±ì í•¨ìˆ˜ê°€ ì•„ë‹ˆë¼ "ì¼ë°˜ í•¨ìˆ˜ í˜¸ì¶œ"ì´ ëœë‹¤.
 * - thisëŠ” ì „ì—­ ê°ì²´(window)ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
 * - í•¨ìˆ˜ì—ì„œ returnì´ ì—†ìœ¼ë©´ undefinedë¥¼ ë°˜í™˜í•œë‹¤.
 */
let myCafe2 = Cafe("latte"); // ì¼ë°˜ í•¨ìˆ˜ í˜¸ì¶œ
console.log(myCafe2); // undefined

/* ============================================================
 * 4. ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
 * ============================================================
 *
 * ì½œë°± í•¨ìˆ˜ë€?
 * - ë‹¤ë¥¸ í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬ë˜ì–´ ê·¸ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
 *
 * ì½œë°± í•¨ìˆ˜ì—ì„œì˜ this:
 * - ê¸°ë³¸ì ìœ¼ë¡œ "ì¼ë°˜ í•¨ìˆ˜ í˜¸ì¶œ"ë¡œ ì·¨ê¸‰ëœë‹¤.
 * - ë”°ë¼ì„œ thisëŠ” ì „ì—­ ê°ì²´(window)ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
 */

const cafe = {
  brand: "ì´ë””ì•¼",
  menu: "",

  /**
   * setMenu ë©”ì„œë“œ
   * - ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œë˜ë©´ thisëŠ” cafe ê°ì²´
   */
  setMenu: function (menu) {
    this.menu = menu;
  },
};

function getMenu(menu, callback) {
  // callbackì€ ì¼ë°˜ í•¨ìˆ˜ í˜¸ì¶œ í˜•íƒœë¡œ ì‹¤í–‰ë¨
  callback(menu);
}

// ì½œë°±ìœ¼ë¡œ ë©”ì„œë“œë¥¼ ì „ë‹¬
getMenu("í•«ì´ˆì½”", cafe.setMenu);

/**
 * ê²°ê³¼ ë¶„ì„
 *
 * - cafe.setMenuê°€ ì½œë°±ìœ¼ë¡œ ì „ë‹¬ë˜ë©´ì„œ "ë©”ì„œë“œ"ê°€ ì•„ë‹ˆë¼ "í•¨ìˆ˜ ì°¸ì¡°"ê°€ ëœë‹¤.
 *
 * - getMenu ë‚´ë¶€ì—ì„œ callback(menu)ëŠ”
 *   ì¼ë°˜ í•¨ìˆ˜ í˜¸ì¶œ í˜•íƒœì´ë¯€ë¡œ
 *   this === window
 *
 * - ë”°ë¼ì„œ cafe.menuê°€ ì•„ë‹ˆë¼
 *   window.menuì— "í•«ì´ˆì½”"ê°€ í• ë‹¹ëœë‹¤.
 */
console.log(cafe); // { brand: "ì´ë””ì•¼", menu: "", setMenu: Æ’ }

// ğŸ“Œ ì•„ë˜ì˜ ë‚´ìš©ì€ ê°•ì˜ì—ëŠ” ì—†ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤.

/* ============================================================
 * í•«ì´ˆì½”ë¥¼ ì „ë‹¬í•˜ë ¤ë©´?
 * ============================================================
 *
 * - setMenuë¥¼ í˜¸ì¶œí•  ë•Œ thisë¥¼ cafeë¡œ ê³ ì •í•´ì•¼ í•œë‹¤.
 *
 * ëŒ€í‘œì ì¸ ë°©ë²•:
 * 1. call / apply
 * 2. bind
 * 3. í™”ì‚´í‘œ í•¨ìˆ˜ë¡œ ê°ì‹¸ê¸°
 */

/* ------------------------------------------------------------
 * ë°©ë²• 1. call ì‚¬ìš©
 * ------------------------------------------------------------ */
getMenu("í•«ì´ˆì½”", function (menu) {
  cafe.setMenu.call(cafe, menu);
});

console.log(cafe); // menu: "í•«ì´ˆì½”"

/* ------------------------------------------------------------
 * ë°©ë²• 2. bind ì‚¬ìš©
 * ------------------------------------------------------------ */
getMenu("ì•„ì´ìŠ¤ì´ˆì½”", cafe.setMenu.bind(cafe));

console.log(cafe); // menu: "ì•„ì´ìŠ¤ì´ˆì½”"

/* ------------------------------------------------------------
 * â­ï¸ ë°©ë²• 3. í™”ì‚´í‘œ í•¨ìˆ˜ë¡œ ê°ì‹¸ê¸°
 * ------------------------------------------------------------ */
getMenu("ë¼ë–¼", (menu) => {
  cafe.setMenu(menu);
});

console.log(cafe); // menu: "ë¼ë–¼"
