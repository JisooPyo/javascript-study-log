/**
 * ============================================================
 * this와 화살표 함수 (Arrow Function)
 * ============================================================
 * - 일반 함수의 this:
 *   → 함수가 "어떻게 호출되었는지"에 따라 동적으로 결정된다.
 *
 * - 화살표 함수의 this:
 *   → 함수가 "어디에서 선언되었는지"에 따라 상위 스코프의 this를 그대로 참조한다.
 *   → 호출 방식과 무관하다.
 */

/* ============================================================
 * 1. 일반 함수 + setInterval
 * ============================================================
 *
 * setInterval의 콜백으로 "일반 함수"를 전달하면
 * 해당 함수는 일반 함수 호출로 실행된다.
 * → this === window (브라우저 기준)
 */

function Counter() {
  this.count = 0;

  setInterval(function () {
    // 여기서 this는 Counter 인스턴스가 아니라
    // 일반 함수 호출로 인해 전역 객체(window)를 가리킨다.
    this.count++; // window.count++
    console.log(this.count);
  }, 2000);
}

// const counter = new Counter();
// 결과: NaN
//
// 이유:
// - window.count는 처음에 undefined
// - undefined++ → NaN

/* ============================================================
 * 2. 화살표 함수 + setInterval
 * ============================================================
 *
 * 화살표 함수는 자신만의 this를 가지지 않는다.
 * 대신, "선언된 위치의 상위 스코프 this"를 그대로 사용한다.
 */

function Counter2() {
  this.count = 0;

  setInterval(() => {
    // 화살표 함수의 this는 Counter2 함수가 실행될 때의 this를 그대로 참조한다.
    // 즉, new Counter2()로 생성된 인스턴스를 가리킨다.
    this.count++;
    console.log(this.count);
  }, 2000);
}

// const counter2 = new Counter2();
// 결과: 1, 2, 3, ...

/* ============================================================
 * 화살표 함수의 this 정리
 * ============================================================
 *
 * - 화살표 함수의 this는 "호출 방식"이 아니라 "선언 시점의 상위 스코프 this"로 결정된다.
 * - 이는 자바스크립트의 Lexical Scope 개념과 유사하다.
 *
 * Lexical Scope란?
 * - 함수가 어디서 호출되었는지가 아니라
 * - 함수가 어디에서 선언되었는지에 따라 스코프가 결정되는 방식
 *
 * 화살표 함수의 this는
 * - 콜백 함수 내부에서 this가 window를 가리키는 문제를 해결하기 위한 대안으로 자주 사용된다.
 */

/* ============================================================
 * 3. 객체 메서드에서 화살표 함수 사용
 * ============================================================
 *
 * ⚠️ 주의: 객체의 메서드에는 화살표 함수를 쓰지 않는 것이 일반적이다.
 */

const cafe = {
  brand: "이디야",
  menu: "아메리카노",

  // 화살표 함수로 선언된 메서드
  print: () => {
    // 화살표 함수의 this는 cafe 객체가 아니라, 선언 위치의 상위 스코프(this)를 참조한다.
    console.log(this); // window
  },
};

cafe.print();

/**
 * 결과 분석
 * ------------------------------------------------------------
 * - print는 cafe의 메서드처럼 보이지만 화살표 함수이기 때문에 this는 cafe가 아니다.
 *
 * - print 함수가 선언된 위치는 전역 스코프
 * - 따라서 this === window
 */
